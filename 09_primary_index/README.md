# Первичный разряженный индекс в Clickhouse

### 1. Создаем таблицу без индекса
```sql
DROP TABLE learn_db.mart_student_lesson;
CREATE TABLE learn_db.mart_student_lesson
(
	`student_profile_id` Int32, -- Идентификатор профиля обучающегося
	`person_id` String, -- GUID обучающегося
	`person_id_int` Int32 CODEC(Delta, ZSTD),
	`educational_organization_id` Int16, -- Идентификатор образовательной организации
	`parallel_id` Int16,
	`class_id` Int16, -- Идентификатор класса
	`lesson_date` Date32, -- Дата урока
	`lesson_month_digits` String,
	`lesson_month_text` String,
	`lesson_year` UInt16,
	`load_date` Date, -- Дата загрузки данных
	`t` Int16 CODEC(Delta, ZSTD),
	`teacher_id` Int32 CODEC(Delta, ZSTD), -- Идентификатор учителя
	`subject_id` Int16 CODEC(Delta, ZSTD), -- Идентификатор предмета
	`subject_name` String,
	`mark` Int8, -- Оценка
	PRIMARY KEY tuple()
) ENGINE = MergeTree()
PARTITION BY (educational_organization_id)
AS SELECT
	floor(randUniform(2, 1300000)) as student_profile_id,
	cast(student_profile_id as String) as person_id,
	cast(person_id as Int32) as  person_id_int,
    student_profile_id / 365000 as educational_organization_id,
    student_profile_id / 73000 as parallel_id,
    student_profile_id / 2000 as class_id,
    cast(now() - randUniform(2, 60*60*24*365) as date) as lesson_date, -- Дата урока
    formatDateTime(lesson_date, '%Y-%m') as lesson_month_digits,
    formatDateTime(lesson_date, '%Y %M') AS lesson_month_text,
    toYear(lesson_date) as lesson_year, 
    lesson_date + rand() % 3, -- Дата загрузки данных
    floor(randUniform(2, 137)) as t,
    educational_organization_id * 136 + t as teacher_id,
    floor(t/9) as subject_id,
    CASE subject_id
    	WHEN 1 THEN 'Математика'
    	WHEN 2 THEN 'Русский язык'
    	WHEN 3 THEN 'Литература'
    	WHEN 4 THEN 'Физика'
    	WHEN 5 THEN 'Химия'
    	WHEN 6 THEN 'География'
    	WHEN 7 THEN 'Биология'
    	WHEN 8 THEN 'Физическая культура'
    	ELSE 'Информатика'
    END as subject_name,
    CASE 
    	WHEN randUniform(0, 2) > 1
    		THEN -1
    		ELSE 
    			CASE
	    			WHEN ROUND(randUniform(0, 5)) + subject_id < 5 THEN ROUND(randUniform(4, 5))
	    			WHEN ROUND(randUniform(0, 5)) + subject_id < 9 THEN ROUND(randUniform(3, 5))
	    			ELSE ROUND(randUniform(2, 5))
    			END				
    END AS mark
FROM numbers(10000000);
```

### 2. Выполняем запрос в clickhouse-client

```sql
SELECT 
	avg(mark) as avg_m,
	teacher_id
FROM 
	learn_db.mart_student_lesson
WHERE 
	lesson_date = subtractDays(today(), 10)
GROUP BY
	teacher_id
ORDER BY avg_m desc
LIMIT 10;
```
Результат
```text

Query id: 6ce9915b-0468-4ecc-b2ad-c37aecae9368

    ┌──────────────avg_m─┬─teacher_id─┐
 1. │                  5 │          4 │
 2. │                  5 │          3 │
 3. │                  5 │         10 │
 4. │                  4 │        618 │
 5. │                  4 │          2 │
 6. │                  4 │        620 │
 7. │ 3.8333333333333335 │         30 │
 8. │                3.8 │         24 │
 9. │ 3.1052631578947367 │         61 │
10. │ 3.0833333333333335 │         14 │
    └────────────────────┴────────────┘

10 rows in set. Elapsed: 0.059 sec. Processed 10.00 million rows, 90.00 MB (168.13 million rows/s., 1.51 GB/s.)
Peak memory usage: 186.69 KiB.
```

### 3. Создаем вторую таблицу с первичным индексом по lesson_date и теми же данными
```
DROP TABLE IF EXISTS learn_db.mart_student_lesson_idx;
CREATE TABLE learn_db.mart_student_lesson_idx
(
	`student_profile_id` Int32, -- Идентификатор профиля обучающегося
	`person_id` String, -- GUID обучающегося
	`person_id_int` Int32 CODEC(Delta, ZSTD),
	`educational_organization_id` Int16, -- Идентификатор образовательной организации
	`parallel_id` Int16,
	`class_id` Int16, -- Идентификатор класса
	`lesson_date` Date32, -- Дата урока
	`lesson_month_digits` String,
	`lesson_month_text` String,
	`lesson_year` UInt16,
	`load_date` Date, -- Дата загрузки данных
	`t` Int16 CODEC(Delta, ZSTD),
	`teacher_id` Int32 CODEC(Delta, ZSTD), -- Идентификатор учителя
	`subject_id` Int16 CODEC(Delta, ZSTD), -- Идентификатор предмета
	`subject_name` String,
	`mark` Int8, -- Оценка
	PRIMARY KEY lesson_date
) ENGINE = MergeTree()
AS
SELECT
	student_profile_id,
	person_id,
	person_id_int,
	educational_organization_id,
	parallel_id,
	class_id,
	lesson_date,
	lesson_month_digits,
	lesson_month_text,
	lesson_year,
	load_date,
	t,
	teacher_id,
	subject_id,
	subject_name,
	mark
FROM
	learn_db.mart_student_lesson;
```
       
### 4. Выполняем запрос в clickhouse-client по второй таблице   
```sql
SELECT 
	avg(mark) as avg_m,
	teacher_id
FROM 
	learn_db.mart_student_lesson_idx
WHERE 
	lesson_date = subtractDays(today(), 10)
GROUP BY
	teacher_id
ORDER BY avg_m desc
LIMIT 10;
```

Результат
```text
Query id: cf2d6d78-c77c-45eb-a99d-a85822f039ea

    ┌──────────────avg_m─┬─teacher_id─┐
 1. │                  5 │          4 │
 2. │                  5 │          3 │
 3. │                  5 │         10 │
 4. │                  4 │        618 │
 5. │                  4 │          2 │
 6. │                  4 │        620 │
 7. │ 3.8333333333333335 │         30 │
 8. │                3.8 │         24 │
 9. │ 3.1052631578947367 │         61 │
10. │ 3.0833333333333335 │         14 │
    └────────────────────┴────────────┘

10 rows in set. Elapsed: 0.010 sec. Processed 65.54 thousand rows, 533.73 KB (6.39 million rows/s., 52.06 MB/s.)
Peak memory usage: 1.66 MiB.
```

### 5. Выполняем запрос на получение названий предметов уроков
```sql
SELECT subject_name, count(*) as cnt FROM learn_db.mart_student_lesson GROUP BY subject_name;
```

Результат
```text
subject_name        |cnt     |
--------------------+--------+
Физика              | 6666872|
Биология            | 6672889|
Химия               | 6667011|
Русский язык        | 6662697|
География           | 6668558|
Литература          | 6664351|
Информатика         |46661462|
Математическая наука| 6667516|
Физическая культура | 6668644|
```

### 6. Получаем строки из 1ой гранулы
```sql
SELECT 
	*
FROM 
	learn_db.mart_student_lesson_idx
ORDER BY lesson_date, person_id_int, mark
LIMIT 8192
OFFSET 8192 * 0;
```

Результат
```text
Query id: 9621105d-de5f-4ef5-9727-a37bc6b31e6f

      ┌─student_profile_id─┬─person_id─┬─person_id_int─┬─educational_organization_id─┬─parallel_id─┬─class_id─┬─lesson_date─┬─lesson_month_digits─┬─lesson_month_text─┬─lesson_year─┬──load_date─┬───t─┬─teacher_id─┬─subject_id─┬─subject_name────────┬─mark─┐
   1. │                 17 │ 17        │            17 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  49 │         49 │          5 │ Химия               │   -1 │
   2. │                 93 │ 93        │            93 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  51 │         51 │          5 │ Химия               │   -1 │
   3. │                126 │ 126       │           126 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  94 │         94 │         10 │ Информатика         │    3 │
   4. │                397 │ 397       │           397 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │ 134 │        134 │         14 │ Информатика         │   -1 │
   5. │                401 │ 401       │           401 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  51 │         51 │          5 │ Химия               │    4 │
   6. │                404 │ 404       │           404 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  42 │         42 │          4 │ Физика              │   -1 │
   7. │                419 │ 419       │           419 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  88 │         88 │          9 │ Информатика         │    4 │
   8. │                436 │ 436       │           436 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  51 │         51 │          5 │ Химия               │    2 │
   9. │                458 │ 458       │           458 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  84 │         84 │          9 │ Информатика         │    4 │
  10. │                495 │ 495       │           495 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │ 116 │        116 │         12 │ Информатика         │    3 │
  11. │                516 │ 516       │           516 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │ 126 │        126 │         14 │ Информатика         │    4 │
  12. │                518 │ 518       │           518 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │   4 │          4 │          0 │ Информатика         │    5 │
  13. │                639 │ 639       │           639 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  54 │         54 │          6 │ География           │    5 │
  14. │                664 │ 664       │           664 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  31 │         31 │          3 │ Литература          │    4 │
  15. │                705 │ 705       │           705 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │ 125 │        125 │         13 │ Информатика         │    2 │
  16. │                730 │ 730       │           730 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  31 │         31 │          3 │ Литература          │    5 │
  17. │                732 │ 732       │           732 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  76 │         76 │          8 │ Физическая культура │   -1 │
  18. │                745 │ 745       │           745 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  84 │         84 │          9 │ Информатика         │    3 │
  19. │                746 │ 746       │           746 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  19 │         19 │          2 │ Русский язык        │    4 │
  20. │                752 │ 752       │           752 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  42 │         42 │          4 │ Физика              │   -1 │
  21. │                764 │ 764       │           764 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  48 │         48 │          5 │ Химия               │    4 │
  22. │                835 │ 835       │           835 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  10 │         10 │          1 │ Математика          │   -1 │
  23. │                836 │ 836       │           836 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  58 │         58 │          6 │ География           │    2 │
  24. │                870 │ 870       │           870 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  79 │         79 │          8 │ Физическая культура │    3 │
  25. │                917 │ 917       │           917 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  48 │         48 │          5 │ Химия               │    4 │
  26. │                984 │ 984       │           984 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │ 126 │        126 │         14 │ Информатика         │    2 │
  27. │               1053 │ 1053      │          1053 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  86 │         86 │          9 │ Информатика         │   -1 │
  28. │               1057 │ 1057      │          1057 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  96 │         96 │         10 │ Информатика         │    3 │
  29. │               1160 │ 1160      │          1160 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  91 │         91 │         10 │ Информатика         │   -1 │
  30. │               1336 │ 1336      │          1336 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │ 112 │        112 │         12 │ Информатика         │   -1 │
  31. │               1408 │ 1408      │          1408 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │ 111 │        111 │         12 │ Информатика         │   -1 │
  32. │               1429 │ 1429      │          1429 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │ 114 │        114 │         12 │ Информатика         │    2 │
  33. │               1495 │ 1495      │          1495 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  85 │         85 │          9 │ Информатика         │   -1 │
  34. │               1506 │ 1506      │          1506 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  34 │         34 │          3 │ Литература          │    4 │
  35. │               1507 │ 1507      │          1507 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │ 114 │        114 │         12 │ Информатика         │    2 │
  36. │               1545 │ 1545      │          1545 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │   9 │          9 │          1 │ Математика          │    4 │
  37. │               1584 │ 1584      │          1584 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  56 │         56 │          6 │ География           │    4 │
  38. │               1621 │ 1621      │          1621 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  89 │         89 │          9 │ Информатика         │   -1 │
  39. │               1680 │ 1680      │          1680 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │ 133 │        133 │         14 │ Информатика         │    3 │
  40. │               1858 │ 1858      │          1858 │                           0 │           0 │        0 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  63 │         63 │          7 │ Биология            │    3 │
  41. │               2093 │ 2093      │          2093 │                           0 │           0 │        1 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  78 │         78 │          8 │ Физическая культура │    5 │
  42. │               2175 │ 2175      │          2175 │                           0 │           0 │        1 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  87 │         87 │          9 │ Информатика         │   -1 │
  43. │               2339 │ 2339      │          2339 │                           0 │           0 │        1 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  38 │         38 │          4 │ Физика              │    3 │
  44. │               2434 │ 2434      │          2434 │                           0 │           0 │        1 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  28 │         28 │          3 │ Литература          │    5 │
  45. │               2451 │ 2451      │          2451 │                           0 │           0 │        1 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  19 │         19 │          2 │ Русский язык        │   -1 │
  46. │               2552 │ 2552      │          2552 │                           0 │           0 │        1 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  48 │         48 │          5 │ Химия               │    2 │
  47. │               2600 │ 2600      │          2600 │                           0 │           0 │        1 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │ 105 │        105 │         11 │ Информатика         │    4 │
  48. │               2643 │ 2643      │          2643 │                           0 │           0 │        1 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  44 │         44 │          4 │ Физика              │   -1 │
  49. │               2653 │ 2653      │          2653 │                           0 │           0 │        1 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │ 111 │        111 │         12 │ Информатика         │   -1 │
  50. │               2678 │ 2678      │          2678 │                           0 │           0 │        1 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  88 │         88 │          9 │ Информатика         │   -1 │
  51. │               2694 │ 2694      │          2694 │                           0 │           0 │        1 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  10 │         11 │          1 │ Математика          │    4 │
  52. │               2719 │ 2719      │          2719 │                           0 │           0 │        1 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  10 │         11 │          1 │ Математика          │   -1 │
  53. │               2794 │ 2794      │          2794 │                           0 │           0 │        1 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  23 │         24 │          2 │ Русский язык        │    4 │
  54. │               2798 │ 2798      │          2798 │                           0 │           0 │        1 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │   7 │          8 │          0 │ Информатика         │   -1 │
  55. │               2832 │ 2832      │          2832 │                           0 │           0 │        1 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  95 │         96 │         10 │ Информатика         │   -1 │
  56. │               2854 │ 2854      │          2854 │                           0 │           0 │        1 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │ 101 │        102 │         11 │ Информатика         │   -1 │
  57. │               2965 │ 2965      │          2965 │                           0 │           0 │        1 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │ 118 │        119 │         13 │ Информатика         │   -1 │
  58. │               3084 │ 3084      │          3084 │                           0 │           0 │        1 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  45 │         46 │          5 │ Химия               │    4 │
  59. │               3166 │ 3166      │          3166 │                           0 │           0 │        1 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  27 │         28 │          3 │ Литература          │    4 │
  60. │               3595 │ 3595      │          3595 │                           0 │           0 │        1 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  12 │         13 │          1 │ Математика          │   -1 │
  61. │               3863 │ 3863      │          3863 │                           0 │           0 │        1 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  10 │         11 │          1 │ Математика          │   -1 │
  62. │               3906 │ 3906      │          3906 │                           0 │           0 │        1 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  36 │         37 │          4 │ Физика              │   -1 │
  63. │               3907 │ 3907      │          3907 │                           0 │           0 │        1 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │ 105 │        106 │         11 │ Информатика         │   -1 │
  64. │               4116 │ 4116      │          4116 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │ 102 │        103 │         11 │ Информатика         │    5 │
  65. │               4139 │ 4139      │          4139 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │ 120 │        121 │         13 │ Информатика         │    4 │
  66. │               4190 │ 4190      │          4190 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  19 │         20 │          2 │ Русский язык        │   -1 │
  67. │               4246 │ 4246      │          4246 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │ 116 │        117 │         12 │ Информатика         │    2 │
  68. │               4252 │ 4252      │          4252 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  42 │         43 │          4 │ Физика              │    4 │
  69. │               4314 │ 4314      │          4314 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  47 │         48 │          5 │ Химия               │   -1 │
  70. │               4332 │ 4332      │          4332 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  57 │         58 │          6 │ География           │    5 │
  71. │               4361 │ 4361      │          4361 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │ 109 │        110 │         12 │ Информатика         │    4 │
  72. │               4396 │ 4396      │          4396 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  33 │         34 │          3 │ Литература          │    5 │
  73. │               4498 │ 4498      │          4498 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  23 │         24 │          2 │ Русский язык        │    4 │
  74. │               4522 │ 4522      │          4522 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  46 │         47 │          5 │ Химия               │   -1 │
  75. │               4535 │ 4535      │          4535 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  32 │         33 │          3 │ Литература          │    3 │
  76. │               4545 │ 4545      │          4545 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  94 │         95 │         10 │ Информатика         │    5 │
  77. │               4635 │ 4635      │          4635 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  59 │         60 │          6 │ География           │    4 │
  78. │               4661 │ 4661      │          4661 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  58 │         59 │          6 │ География           │    2 │
  79. │               4863 │ 4863      │          4863 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │ 112 │        113 │         12 │ Информатика         │   -1 │
  80. │               4919 │ 4919      │          4919 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │ 125 │        126 │         13 │ Информатика         │   -1 │
  81. │               5047 │ 5047      │          5047 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  75 │         76 │          8 │ Физическая культура │    4 │
  82. │               5173 │ 5173      │          5173 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  26 │         27 │          2 │ Русский язык        │    5 │
  83. │               5197 │ 5197      │          5197 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  94 │         95 │         10 │ Информатика         │    4 │
  84. │               5239 │ 5239      │          5239 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │ 119 │        120 │         13 │ Информатика         │    4 │
  85. │               5299 │ 5299      │          5299 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  87 │         88 │          9 │ Информатика         │    2 │
  86. │               5384 │ 5384      │          5384 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  13 │         15 │          1 │ Математика          │    4 │
  87. │               5441 │ 5441      │          5441 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  55 │         57 │          6 │ География           │   -1 │
  88. │               5516 │ 5516      │          5516 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  24 │         26 │          2 │ Русский язык        │   -1 │
  89. │               5627 │ 5627      │          5627 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  38 │         40 │          4 │ Физика              │   -1 │
  90. │               5754 │ 5754      │          5754 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  22 │         24 │          2 │ Русский язык        │   -1 │
  91. │               5812 │ 5812      │          5812 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │ 120 │        122 │         13 │ Информатика         │    3 │
  92. │               5842 │ 5842      │          5842 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  56 │         58 │          6 │ География           │    4 │
  93. │               5848 │ 5848      │          5848 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  31 │         33 │          3 │ Литература          │    4 │
  94. │               5878 │ 5878      │          5878 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  48 │         50 │          5 │ Химия               │   -1 │
  95. │               5920 │ 5920      │          5920 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  26 │         28 │          2 │ Русский язык        │    4 │
  96. │               5932 │ 5932      │          5932 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │ 133 │        135 │         14 │ Информатика         │   -1 │
  97. │               5980 │ 5980      │          5980 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │ 105 │        107 │         11 │ Информатика         │   -1 │
  98. │               5989 │ 5989      │          5989 │                           0 │           0 │        2 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  36 │         38 │          4 │ Физика              │   -1 │
  99. │               6104 │ 6104      │          6104 │                           0 │           0 │        3 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │ 129 │        131 │         14 │ Информатика         │   -1 │
 100. │               6110 │ 6110      │          6110 │                           0 │           0 │        3 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  56 │         58 │          6 │ География           │   -1 │
...

8100. │             496611 │ 496611    │        496611 │                           1 │           6 │      248 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  96 │        281 │         10 │ Информатика         │   -1 │
8101. │             496660 │ 496660    │        496660 │                           1 │           6 │      248 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  38 │        223 │          4 │ Физика              │   -1 │
8102. │             496762 │ 496762    │        496762 │                           1 │           6 │      248 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │ 130 │        315 │         14 │ Информатика         │    3 │
8103. │             496810 │ 496810    │        496810 │                           1 │           6 │      248 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  20 │        205 │          2 │ Русский язык        │   -1 │
8104. │             496827 │ 496827    │        496827 │                           1 │           6 │      248 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  38 │        223 │          4 │ Физика              │   -1 │
8105. │             496828 │ 496828    │        496828 │                           1 │           6 │      248 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  45 │        230 │          5 │ Химия               │   -1 │
8106. │             496890 │ 496890    │        496890 │                           1 │           6 │      248 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  15 │        200 │          1 │ Математика          │    4 │
8107. │             496908 │ 496908    │        496908 │                           1 │           6 │      248 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  92 │        277 │         10 │ Информатика         │    5 │
8108. │             496951 │ 496951    │        496951 │                           1 │           6 │      248 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  86 │        271 │          9 │ Информатика         │   -1 │
8109. │             497245 │ 497245    │        497245 │                           1 │           6 │      248 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  85 │        270 │          9 │ Информатика         │   -1 │
8110. │             497322 │ 497322    │        497322 │                           1 │           6 │      248 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  49 │        234 │          5 │ Химия               │   -1 │
8111. │             497718 │ 497718    │        497718 │                           1 │           6 │      248 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │   7 │        192 │          0 │ Информатика         │   -1 │
8112. │             497955 │ 497955    │        497955 │                           1 │           6 │      248 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │ 122 │        307 │         13 │ Информатика         │   -1 │
8113. │             497964 │ 497964    │        497964 │                           1 │           6 │      248 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │ 121 │        306 │         13 │ Информатика         │    3 │
8114. │             498045 │ 498045    │        498045 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  41 │        226 │          4 │ Физика              │   -1 │
8115. │             498135 │ 498135    │        498135 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │ 110 │        295 │         12 │ Информатика         │   -1 │
8116. │             498171 │ 498171    │        498171 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │   9 │        194 │          1 │ Математика          │   -1 │
8117. │             498176 │ 498176    │        498176 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │ 102 │        287 │         11 │ Информатика         │    3 │
8118. │             498234 │ 498234    │        498234 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  32 │        217 │          3 │ Литература          │   -1 │
8119. │             498275 │ 498275    │        498275 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  97 │        282 │         10 │ Информатика         │   -1 │
8120. │             498534 │ 498534    │        498534 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  17 │        202 │          1 │ Математика          │    5 │
8121. │             498545 │ 498545    │        498545 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  57 │        242 │          6 │ География           │   -1 │
8122. │             498549 │ 498549    │        498549 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │ 131 │        316 │         14 │ Информатика         │    3 │
8123. │             498552 │ 498552    │        498552 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │ 116 │        301 │         12 │ Информатика         │   -1 │
8124. │             498699 │ 498699    │        498699 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  23 │        208 │          2 │ Русский язык        │    4 │
8125. │             498716 │ 498716    │        498716 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │ 132 │        317 │         14 │ Информатика         │   -1 │
8126. │             498753 │ 498753    │        498753 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │   9 │        194 │          1 │ Математика          │   -1 │
8127. │             498868 │ 498868    │        498868 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  70 │        255 │          7 │ Биология            │   -1 │
8128. │             498886 │ 498886    │        498886 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │ 109 │        294 │         12 │ Информатика         │   -1 │
8129. │             498917 │ 498917    │        498917 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  58 │        243 │          6 │ География           │    4 │
8130. │             499012 │ 499012    │        499012 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │ 109 │        294 │         12 │ Информатика         │   -1 │
8131. │             499058 │ 499058    │        499058 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │   6 │        191 │          0 │ Информатика         │    4 │
8132. │             499162 │ 499162    │        499162 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │ 128 │        313 │         14 │ Информатика         │   -1 │
8133. │             499199 │ 499199    │        499199 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  61 │        247 │          6 │ География           │    4 │
8134. │             499256 │ 499256    │        499256 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │ 111 │        297 │         12 │ Информатика         │   -1 │
8135. │             499294 │ 499294    │        499294 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  79 │        265 │          8 │ Физическая культура │   -1 │
8136. │             499317 │ 499317    │        499317 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │ 102 │        288 │         11 │ Информатика         │   -1 │
8137. │             499416 │ 499416    │        499416 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  78 │        264 │          8 │ Физическая культура │   -1 │
8138. │             499436 │ 499436    │        499436 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │ 119 │        305 │         13 │ Информатика         │   -1 │
8139. │             499452 │ 499452    │        499452 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │ 126 │        312 │         14 │ Информатика         │    4 │
8140. │             499493 │ 499493    │        499493 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  49 │        235 │          5 │ Химия               │    4 │
8141. │             499508 │ 499508    │        499508 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │ 100 │        286 │         11 │ Информатика         │    3 │
8142. │             499538 │ 499538    │        499538 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  63 │        249 │          7 │ Биология            │    2 │
8143. │             499562 │ 499562    │        499562 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  72 │        258 │          8 │ Физическая культура │    2 │
8144. │             499695 │ 499695    │        499695 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  70 │        256 │          7 │ Биология            │   -1 │
8145. │             499726 │ 499726    │        499726 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │ 115 │        301 │         12 │ Информатика         │    4 │
8146. │             499745 │ 499745    │        499745 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │ 104 │        290 │         11 │ Информатика         │   -1 │
8147. │             499902 │ 499902    │        499902 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  24 │        210 │          2 │ Русский язык        │   -1 │
8148. │             499928 │ 499928    │        499928 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  98 │        284 │         10 │ Информатика         │    2 │
8149. │             499940 │ 499940    │        499940 │                           1 │           6 │      249 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  29 │        215 │          3 │ Литература          │   -1 │
8150. │             500153 │ 500153    │        500153 │                           1 │           6 │      250 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  58 │        244 │          6 │ География           │    5 │
8151. │             500328 │ 500328    │        500328 │                           1 │           6 │      250 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │ 132 │        318 │         14 │ Информатика         │   -1 │
8152. │             500539 │ 500539    │        500539 │                           1 │           6 │      250 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  75 │        261 │          8 │ Физическая культура │    3 │
8153. │             500553 │ 500553    │        500553 │                           1 │           6 │      250 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  30 │        216 │          3 │ Литература          │   -1 │
8154. │             500583 │ 500583    │        500583 │                           1 │           6 │      250 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  62 │        248 │          6 │ География           │    3 │
8155. │             500623 │ 500623    │        500623 │                           1 │           6 │      250 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  85 │        271 │          9 │ Информатика         │   -1 │
8156. │             500661 │ 500661    │        500661 │                           1 │           6 │      250 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  51 │        237 │          5 │ Химия               │    5 │
8157. │             500724 │ 500724    │        500724 │                           1 │           6 │      250 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │   6 │        192 │          0 │ Информатика         │   -1 │
8158. │             500728 │ 500728    │        500728 │                           1 │           6 │      250 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  58 │        244 │          6 │ География           │    3 │
8159. │             500832 │ 500832    │        500832 │                           1 │           6 │      250 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │   9 │        195 │          1 │ Математика          │   -1 │
8160. │             500833 │ 500833    │        500833 │                           1 │           6 │      250 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  10 │        196 │          1 │ Математика          │    4 │
8161. │             500877 │ 500877    │        500877 │                           1 │           6 │      250 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │ 108 │        294 │         12 │ Информатика         │   -1 │
8162. │             500879 │ 500879    │        500879 │                           1 │           6 │      250 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │   2 │        188 │          0 │ Информатика         │    5 │
8163. │             500994 │ 500994    │        500994 │                           1 │           6 │      250 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │ 106 │        292 │         11 │ Информатика         │    2 │
8164. │             501247 │ 501247    │        501247 │                           1 │           6 │      250 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │ 131 │        317 │         14 │ Информатика         │    2 │
8165. │             501301 │ 501301    │        501301 │                           1 │           6 │      250 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  99 │        285 │         11 │ Информатика         │    3 │
8166. │             501313 │ 501313    │        501313 │                           1 │           6 │      250 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │ 109 │        295 │         12 │ Информатика         │   -1 │
8167. │             501316 │ 501316    │        501316 │                           1 │           6 │      250 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  20 │        206 │          2 │ Русский язык        │    3 │
8168. │             501319 │ 501319    │        501319 │                           1 │           6 │      250 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │ 118 │        304 │         13 │ Информатика         │    5 │
8169. │             501325 │ 501325    │        501325 │                           1 │           6 │      250 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  75 │        261 │          8 │ Физическая культура │   -1 │
8170. │             501380 │ 501380    │        501380 │                           1 │           6 │      250 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  16 │        202 │          1 │ Математика          │   -1 │
8171. │             501409 │ 501409    │        501409 │                           1 │           6 │      250 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  61 │        247 │          6 │ География           │   -1 │
8172. │             501424 │ 501424    │        501424 │                           1 │           6 │      250 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  62 │        248 │          6 │ География           │   -1 │
8173. │             501425 │ 501425    │        501425 │                           1 │           6 │      250 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  43 │        229 │          4 │ Физика              │    5 │
8174. │             501435 │ 501435    │        501435 │                           1 │           6 │      250 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  10 │        196 │          1 │ Математика          │   -1 │
8175. │             501695 │ 501695    │        501695 │                           1 │           6 │      250 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │ 104 │        290 │         11 │ Информатика         │   -1 │
8176. │             501745 │ 501745    │        501745 │                           1 │           6 │      250 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  92 │        278 │         10 │ Информатика         │    3 │
8177. │             501826 │ 501826    │        501826 │                           1 │           6 │      250 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  19 │        205 │          2 │ Русский язык        │    4 │
8178. │             501846 │ 501846    │        501846 │                           1 │           6 │      250 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  79 │        265 │          8 │ Физическая культура │   -1 │
8179. │             501918 │ 501918    │        501918 │                           1 │           6 │      250 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  59 │        246 │          6 │ География           │   -1 │
8180. │             501939 │ 501939    │        501939 │                           1 │           6 │      250 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │ 120 │        307 │         13 │ Информатика         │   -1 │
8181. │             501959 │ 501959    │        501959 │                           1 │           6 │      250 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │ 120 │        307 │         13 │ Информатика         │    4 │
8182. │             501982 │ 501982    │        501982 │                           1 │           6 │      250 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │ 131 │        318 │         14 │ Информатика         │   -1 │
8183. │             502063 │ 502063    │        502063 │                           1 │           6 │      251 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │ 121 │        308 │         13 │ Информатика         │   -1 │
8184. │             502086 │ 502086    │        502086 │                           1 │           6 │      251 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │  19 │        206 │          2 │ Русский язык        │   -1 │
8185. │             502090 │ 502090    │        502090 │                           1 │           6 │      251 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │ 112 │        299 │         12 │ Информатика         │   -1 │
8186. │             502093 │ 502093    │        502093 │                           1 │           6 │      251 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │ 107 │        294 │         11 │ Информатика         │   -1 │
8187. │             502168 │ 502168    │        502168 │                           1 │           6 │      251 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-21 │ 127 │        314 │         14 │ Информатика         │    3 │
8188. │             502184 │ 502184    │        502184 │                           1 │           6 │      251 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  92 │        279 │         10 │ Информатика         │   -1 │
8189. │             502278 │ 502278    │        502278 │                           1 │           6 │      251 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │   7 │        194 │          0 │ Информатика         │    5 │
8190. │             502422 │ 502422    │        502422 │                           1 │           6 │      251 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  96 │        283 │         10 │ Информатика         │   -1 │
8191. │             502477 │ 502477    │        502477 │                           1 │           6 │      251 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-22 │  31 │        218 │          3 │ Литература          │   -1 │
8192. │             502606 │ 502606    │        502606 │                           1 │           6 │      251 │  2024-09-20 │ 2024-09             │ 2024 September    │        2024 │ 2024-09-20 │  64 │        251 │          7 │ Биология            │    3 │
      └─student_profile_id─┴─person_id─┴─person_id_int─┴─educational_organization_id─┴─parallel_id─┴─class_id─┴─lesson_date─┴─lesson_month_digits─┴─lesson_month_text─┴─lesson_year─┴──load_date─┴───t─┴─teacher_id─┴─subject_id─┴─subject_name────────┴─mark─┘
Showed 1000 out of 8192 rows.

8192 rows in set. Elapsed: 1.287 sec. Processed 10.00 million rows, 1.12 GB (7.77 million rows/s., 870.20 MB/s.)
Peak memory usage: 72.82 MiB.
```

### 7. Получаем список всех частей данных таблицы mart_student_lesson_idx
```
SELECT path FROM system.parts where table = 'mart_student_lesson_idx' AND active = 1;
```

### 8. Включение легковесного редактирования на уровне сессии
```
SET allow_experimental_lightweight_update = 1;
```

Результат
```text
path                                                                           |
-------------------------------------------------------------------------------+
/var/lib/clickhouse/store/da7/da7b7d14-c077-4e7c-8a23-5c378a702892/all_1_6_1/  |
/var/lib/clickhouse/store/da7/da7b7d14-c077-4e7c-8a23-5c378a702892/all_7_7_0/  |
/var/lib/clickhouse/store/da7/da7b7d14-c077-4e7c-8a23-5c378a702892/all_8_8_0/  |
/var/lib/clickhouse/store/da7/da7b7d14-c077-4e7c-8a23-5c378a702892/all_9_9_0/  |
/var/lib/clickhouse/store/da7/da7b7d14-c077-4e7c-8a23-5c378a702892/all_10_10_0/|
```

### 9. Смотрим на гранулы в частях данных
```sql
SELECT * FROM mergeTreeIndex('learn_db', 'mart_student_lesson_idx');
```

Результат
```text
part_name  |mark_number|rows_in_granule|lesson_date|
-----------+-----------+---------------+-----------+
all_1_6_1  |          0|           8192| 2024-09-20|
all_1_6_1  |          1|           8192| 2024-09-20|
all_1_6_1  |          2|           8192| 2024-09-21|
all_1_6_1  |          3|           8192| 2024-09-21|
all_1_6_1  |          4|           8192| 2024-09-22|
all_1_6_1  |          5|           8192| 2024-09-22|
all_1_6_1  |          6|           8192| 2024-09-23|
all_1_6_1  |          7|           8192| 2024-09-23|
all_1_6_1  |          8|           8192| 2024-09-24|
all_1_6_1  |          9|           8192| 2024-09-24|
all_1_6_1  |         10|           8192| 2024-09-24|
all_1_6_1  |         11|           8192| 2024-09-25|
all_1_6_1  |         12|           8192| 2024-09-25|
all_1_6_1  |         13|           8192| 2024-09-26|
all_1_6_1  |         14|           8192| 2024-09-26|
all_1_6_1  |         15|           8192| 2024-09-27|
all_1_6_1  |         16|           8192| 2024-09-27|
all_1_6_1  |         17|           8192| 2024-09-28|
all_1_6_1  |         18|           8192| 2024-09-28|
all_1_6_1  |         19|           8192| 2024-09-29|
all_1_6_1  |         20|           8192| 2024-09-29|
all_1_6_1  |         21|           8192| 2024-09-30|
all_1_6_1  |         22|           8192| 2024-09-30|
all_1_6_1  |         23|           8192| 2024-10-01|
all_1_6_1  |         24|           8192| 2024-10-01|
all_1_6_1  |         25|           8192| 2024-10-02|
all_1_6_1  |         26|           8192| 2024-10-02|
all_1_6_1  |         27|           8192| 2024-10-03|
all_1_6_1  |         28|           8192| 2024-10-03|
all_1_6_1  |         29|           8192| 2024-10-04|
all_1_6_1  |         30|           8192| 2024-10-04|
all_1_6_1  |         31|           8192| 2024-10-04|
all_1_6_1  |         32|           8192| 2024-10-05|
all_1_6_1  |         33|           8192| 2024-10-05|
all_1_6_1  |         34|           8192| 2024-10-06|
all_1_6_1  |         35|           8192| 2024-10-06|
all_1_6_1  |         36|           8192| 2024-10-07|
all_1_6_1  |         37|           8192| 2024-10-07|
all_1_6_1  |         38|           8192| 2024-10-08|
all_1_6_1  |         39|           8192| 2024-10-08|
all_1_6_1  |         40|           8192| 2024-10-09|
all_1_6_1  |         41|           8192| 2024-10-09|
all_1_6_1  |         42|           8192| 2024-10-10|
all_1_6_1  |         43|           8192| 2024-10-10|
all_1_6_1  |         44|           8192| 2024-10-11|
all_1_6_1  |         45|           8192| 2024-10-11|
all_1_6_1  |         46|           8192| 2024-10-12|
all_1_6_1  |         47|           8192| 2024-10-12|
all_1_6_1  |         48|           8192| 2024-10-13|
all_1_6_1  |         49|           8192| 2024-10-13|
all_1_6_1  |         50|           8192| 2024-10-13|
all_1_6_1  |         51|           8192| 2024-10-14|
all_1_6_1  |         52|           8192| 2024-10-14|
all_1_6_1  |         53|           8192| 2024-10-15|
all_1_6_1  |         54|           8192| 2024-10-15|
all_1_6_1  |         55|           8192| 2024-10-16|
all_1_6_1  |         56|           8192| 2024-10-16|
all_1_6_1  |         57|           8192| 2024-10-17|
all_1_6_1  |         58|           8192| 2024-10-17|
all_1_6_1  |         59|           8192| 2024-10-18|
all_1_6_1  |         60|           8192| 2024-10-18|
all_1_6_1  |         61|           8192| 2024-10-19|
all_1_6_1  |         62|           8192| 2024-10-19|
all_1_6_1  |         63|           8192| 2024-10-20|
all_1_6_1  |         64|           8192| 2024-10-20|
all_1_6_1  |         65|           8192| 2024-10-21|
all_1_6_1  |         66|           8192| 2024-10-21|
all_1_6_1  |         67|           8192| 2024-10-22|
all_1_6_1  |         68|           8192| 2024-10-22|
all_1_6_1  |         69|           8192| 2024-10-22|
all_1_6_1  |         70|           8192| 2024-10-23|
all_1_6_1  |         71|           8192| 2024-10-23|
all_1_6_1  |         72|           8192| 2024-10-24|
all_1_6_1  |         73|           8192| 2024-10-24|
all_1_6_1  |         74|           8192| 2024-10-25|
all_1_6_1  |         75|           8192| 2024-10-25|
all_1_6_1  |         76|           8192| 2024-10-26|
all_1_6_1  |         77|           8192| 2024-10-26|
all_1_6_1  |         78|           8192| 2024-10-27|
all_1_6_1  |         79|           8192| 2024-10-27|
all_1_6_1  |         80|           8192| 2024-10-28|
all_1_6_1  |         81|           8192| 2024-10-28|
all_1_6_1  |         82|           8192| 2024-10-29|
all_1_6_1  |         83|           8192| 2024-10-29|
all_1_6_1  |         84|           8192| 2024-10-30|
all_1_6_1  |         85|           8192| 2024-10-30|
all_1_6_1  |         86|           8192| 2024-10-31|
all_1_6_1  |         87|           8192| 2024-10-31|
all_1_6_1  |         88|           8192| 2024-10-31|
all_1_6_1  |         89|           8192| 2024-11-01|
all_1_6_1  |         90|           8192| 2024-11-01|
all_1_6_1  |         91|           8192| 2024-11-02|
all_1_6_1  |         92|           8192| 2024-11-02|
all_1_6_1  |         93|           8192| 2024-11-03|
all_1_6_1  |         94|           8192| 2024-11-03|
all_1_6_1  |         95|           8192| 2024-11-04|
all_1_6_1  |         96|           8192| 2024-11-04|
all_1_6_1  |         97|           8192| 2024-11-05|
all_1_6_1  |         98|           8192| 2024-11-05|
all_1_6_1  |         99|           8192| 2024-11-06|
all_1_6_1  |        100|           8192| 2024-11-06|
...
all_9_9_0  |        110|           8192| 2025-07-29|
all_9_9_0  |        111|           8192| 2025-07-31|
all_9_9_0  |        112|           8192| 2025-08-03|
all_9_9_0  |        113|           8192| 2025-08-06|
all_9_9_0  |        114|           8192| 2025-08-09|
all_9_9_0  |        115|           8192| 2025-08-12|
all_9_9_0  |        116|           8192| 2025-08-15|
all_9_9_0  |        117|           8192| 2025-08-18|
all_9_9_0  |        118|           8192| 2025-08-20|
all_9_9_0  |        119|           8192| 2025-08-23|
all_9_9_0  |        120|           8192| 2025-08-26|
all_9_9_0  |        121|           8192| 2025-08-29|
all_9_9_0  |        122|           8192| 2025-09-01|
all_9_9_0  |        123|           8192| 2025-09-04|
all_9_9_0  |        124|           8192| 2025-09-06|
all_9_9_0  |        125|           8192| 2025-09-09|
all_9_9_0  |        126|           8192| 2025-09-12|
all_9_9_0  |        127|           8192| 2025-09-15|
all_9_9_0  |        128|           5232| 2025-09-18|
all_9_9_0  |        129|              0| 2025-09-20|
all_10_10_0|          0|           8192| 2024-09-20|
all_10_10_0|          1|           8192| 2024-09-25|
all_10_10_0|          2|           8192| 2024-10-01|
all_10_10_0|          3|           8192| 2024-10-07|
all_10_10_0|          4|           8192| 2024-10-12|
all_10_10_0|          5|           8192| 2024-10-18|
all_10_10_0|          6|           8192| 2024-10-24|
all_10_10_0|          7|           8192| 2024-10-30|
all_10_10_0|          8|           8192| 2024-11-04|
all_10_10_0|          9|           8192| 2024-11-10|
all_10_10_0|         10|           8192| 2024-11-16|
all_10_10_0|         11|           8192| 2024-11-21|
all_10_10_0|         12|           8192| 2024-11-27|
all_10_10_0|         13|           8192| 2024-12-03|
all_10_10_0|         14|           8192| 2024-12-09|
all_10_10_0|         15|           8192| 2024-12-14|
all_10_10_0|         16|           8192| 2024-12-20|
all_10_10_0|         17|           8192| 2024-12-25|
all_10_10_0|         18|           8192| 2024-12-31|
all_10_10_0|         19|           8192| 2025-01-06|
all_10_10_0|         20|           8192| 2025-01-12|
all_10_10_0|         21|           8192| 2025-01-17|
all_10_10_0|         22|           8192| 2025-01-23|
all_10_10_0|         23|           8192| 2025-01-29|
all_10_10_0|         24|           8192| 2025-02-03|
all_10_10_0|         25|           8192| 2025-02-09|
all_10_10_0|         26|           8192| 2025-02-15|
all_10_10_0|         27|           8192| 2025-02-21|
all_10_10_0|         28|           8192| 2025-02-27|
all_10_10_0|         29|           8192| 2025-03-04|
all_10_10_0|         30|           8192| 2025-03-10|
all_10_10_0|         31|           8192| 2025-03-16|
all_10_10_0|         32|           8192| 2025-03-22|
all_10_10_0|         33|           8192| 2025-03-27|
all_10_10_0|         34|           8192| 2025-04-02|
all_10_10_0|         35|           8192| 2025-04-08|
all_10_10_0|         36|           8192| 2025-04-14|
all_10_10_0|         37|           8192| 2025-04-19|
all_10_10_0|         38|           8192| 2025-04-25|
all_10_10_0|         39|           8192| 2025-05-01|
all_10_10_0|         40|           8192| 2025-05-06|
all_10_10_0|         41|           8192| 2025-05-12|
all_10_10_0|         42|           8192| 2025-05-18|
all_10_10_0|         43|           8192| 2025-05-24|
all_10_10_0|         44|           8192| 2025-05-29|
all_10_10_0|         45|           8192| 2025-06-04|
all_10_10_0|         46|           8192| 2025-06-10|
all_10_10_0|         47|           8192| 2025-06-16|
all_10_10_0|         48|           8192| 2025-06-21|
all_10_10_0|         49|           8192| 2025-06-27|
all_10_10_0|         50|           8192| 2025-07-03|
all_10_10_0|         51|           8192| 2025-07-08|
all_10_10_0|         52|           8192| 2025-07-14|
all_10_10_0|         53|           8192| 2025-07-20|
all_10_10_0|         54|           8192| 2025-07-25|
all_10_10_0|         55|           8192| 2025-07-31|
all_10_10_0|         56|           8192| 2025-08-06|
all_10_10_0|         57|           8192| 2025-08-11|
all_10_10_0|         58|           8192| 2025-08-17|
all_10_10_0|         59|           8192| 2025-08-23|
all_10_10_0|         60|           8192| 2025-08-29|
all_10_10_0|         61|           8192| 2025-09-04|
all_10_10_0|         62|           8192| 2025-09-09|
all_10_10_0|         63|           6888| 2025-09-15|
all_10_10_0|         64|              0| 2025-09-20|
```

### 10. Смотрим на засечки в каждой часте данных
```
SELECT
    part_name,
    max(mark_number) as entries
FROM mergeTreeIndex('learn_db', 'mart_student_lesson_idx')
GROUP BY part_name;
```

Результат
```text
part_name  |entries|
-----------+-------+
all_9_9_0  |    129|
all_10_10_0|     64|
all_8_8_0  |    129|
all_1_6_1  |    774|
all_7_7_0  |    129|
```

### 11. Смотрим план выполнения запроса со статистикой по применению индекса
```
EXPLAIN indexes = 1
SELECT 
	avg(mark) as avg_m,
	teacher_id
FROM 
	learn_db.mart_student_lesson_idx
WHERE 
	lesson_date = subtractDays(today(), 10)
GROUP BY
	teacher_id
ORDER BY avg_m desc
LIMIT 10;
```

Результат
```text 
explain                                                           |
------------------------------------------------------------------+
Expression (Project names)                                        |
  Limit (preliminary LIMIT (without OFFSET))                      |
    Sorting (Sorting for ORDER BY)                                |
      Expression ((Before ORDER BY + Projection))                 |
        Aggregating                                               |
          Expression (Before GROUP BY)                            |
            Expression                                            |
              ReadFromMergeTree (learn_db.mart_student_lesson_idx)|
              Indexes:                                            |
                PrimaryKey                                        |
                  Keys:                                           |
                    lesson_date                                   |
                  Condition: (lesson_date in [20341, 20341])      |
                  Parts: 5/5                                      |
                  Granules: 8/1225                                |
```

### 12. Пересоздаем таблицу с размером гранулы 4096
```sql
DROP TABLE IF EXISTS learn_db.mart_student_lesson_idx;
CREATE TABLE learn_db.mart_student_lesson_idx
(
	`student_profile_id` Int32, -- Идентификатор профиля обучающегося
	`person_id` String, -- GUID обучающегося
	`person_id_int` Int32 CODEC(Delta, ZSTD),
	`educational_organization_id` Int16, -- Идентификатор образовательной организации
	`parallel_id` Int16,
	`class_id` Int16, -- Идентификатор класса
	`lesson_date` Date32, -- Дата урока
	`lesson_month_digits` String,
	`lesson_month_text` String,
	`lesson_year` UInt16,
	`load_date` Date, -- Дата загрузки данных
	`t` Int16 CODEC(Delta, ZSTD),
	`teacher_id` Int32 CODEC(Delta, ZSTD), -- Идентификатор учителя
	`subject_id` Int16 CODEC(Delta, ZSTD), -- Идентификатор предмета
	`subject_name` String,
	`mark` Int8, -- Оценка
	PRIMARY KEY lesson_date
) ENGINE = MergeTree()
SETTINGS index_granularity = 4096
AS
SELECT
	student_profile_id,
	person_id,
	person_id_int,
	educational_organization_id,
	parallel_id,
	class_id,
	lesson_date,
	lesson_month_digits,
	lesson_month_text,
	lesson_year,
	load_date,
	t,
	teacher_id,
	subject_id,
	subject_name,
	mark
FROM
	learn_db.mart_student_lesson;
```

### 13. Пересоздаем таблицу с индексом по трем столбцам
```sql
DROP TABLE IF EXISTS learn_db.mart_student_lesson_idx;
CREATE TABLE learn_db.mart_student_lesson_idx
(
	`student_profile_id` Int32, -- Идентификатор профиля обучающегося
	`person_id` String, -- GUID обучающегося
	`person_id_int` Int32 CODEC(Delta, ZSTD),
	`educational_organization_id` Int16, -- Идентификатор образовательной организации
	`parallel_id` Int16,
	`class_id` Int16, -- Идентификатор класса
	`lesson_date` Date32, -- Дата урока
	`lesson_month_digits` String,
	`lesson_month_text` String,
	`lesson_year` UInt16,
	`load_date` Date, -- Дата загрузки данных
	`t` Int16 CODEC(Delta, ZSTD),
	`teacher_id` Int32 CODEC(Delta, ZSTD), -- Идентификатор учителя
	`subject_id` Int16 CODEC(Delta, ZSTD), -- Идентификатор предмета
	`subject_name` String,
	`mark` Int8, -- Оценка
	PRIMARY KEY (lesson_date, person_id_int, mark)
) ENGINE = MergeTree()
AS
SELECT
	student_profile_id,
	person_id,
	person_id_int,
	educational_organization_id,
	parallel_id,
	class_id,
	lesson_date,
	lesson_month_digits,
	lesson_month_text,
	lesson_year,
	load_date,
	t,
	teacher_id,
	subject_id,
	subject_name,
	mark
FROM
	learn_db.mart_student_lesson;
```

### 14. Смотрим эффективность фильтрации по второму полю в индексе

```sql
EXPLAIN indexes = 1
SELECT 
	avg(mark) as avg_m,
	teacher_id
FROM 
	learn_db.mart_student_lesson_idx
WHERE 
	person_id_int = 1000
GROUP BY
	teacher_id
ORDER BY avg_m desc
LIMIT 10;
```

Результат
```text
explain                                                           |
------------------------------------------------------------------+
Expression (Project names)                                        |
  Limit (preliminary LIMIT (without OFFSET))                      |
    Sorting (Sorting for ORDER BY)                                |
      Expression ((Before ORDER BY + Projection))                 |
        Aggregating                                               |
          Expression (Before GROUP BY)                            |
            Expression                                            |
              ReadFromMergeTree (learn_db.mart_student_lesson_idx)|
              Indexes:                                            |
                PrimaryKey                                        |
                  Keys:                                           |
                    person_id_int                                 |
                  Condition: (person_id_int in [1000, 1000])      |
                  Parts: 5/5                                      |
                  Granules: 821/1225                              |
```

### 15. Смотрим, в какое количество частей данный попадает на самом деле person_id_int = 1000
```sql
SELECT DISTINCT 
	_part
FROM 
	learn_db.mart_student_lesson_idx
WHERE 
	person_id_int = 1000;
```

Результат
```text
_part    |
---------+
all_9_9_0|
all_7_7_0|
all_1_6_1|
all_8_8_0|
```

### 16. Получаем строки первой гранулы
```sql
SELECT 
	lesson_date, person_id_int, mark
FROM 
	learn_db.mart_student_lesson_idx
ORDER BY 
	lesson_date, person_id_int, mark
LIMIT 8192
OFFSET 8192 * 0;
```

Результат
```text
lesson_date|person_id_int|mark|
-----------+-------------+----+
 2024-09-20|           17|  -1|
 2024-09-20|           93|  -1|
 2024-09-20|          126|   3|
 2024-09-20|          397|  -1|
 2024-09-20|          401|   4|
 2024-09-20|          404|  -1|
 2024-09-20|          419|   4|
 2024-09-20|          436|   2|
 2024-09-20|          458|   4|
 2024-09-20|          495|   3|
 2024-09-20|          516|   4|
 2024-09-20|          518|   5|
 2024-09-20|          639|   5|
 2024-09-20|          664|   4|
 2024-09-20|          705|   2|
 2024-09-20|          730|   5|
 2024-09-20|          732|  -1|
 2024-09-20|          745|   3|
 2024-09-20|          746|   4|
 2024-09-20|          752|  -1|
 2024-09-20|          764|   4|
 2024-09-20|          835|  -1|
 2024-09-20|          836|   2|
 2024-09-20|          870|   3|
 2024-09-20|          917|   4|
 2024-09-20|          984|   2|
 2024-09-20|         1053|  -1|
 2024-09-20|         1057|   3|
 2024-09-20|         1160|  -1|
 2024-09-20|         1336|  -1|
 2024-09-20|         1408|  -1|
 2024-09-20|         1429|   2|
 2024-09-20|         1495|  -1|
 2024-09-20|         1506|   4|
 2024-09-20|         1507|   2|
 2024-09-20|         1545|   4|
 2024-09-20|         1584|   4|
 2024-09-20|         1621|  -1|
 2024-09-20|         1680|   3|
 2024-09-20|         1858|   3|
 2024-09-20|         2093|   5|
 2024-09-20|         2175|  -1|
 2024-09-20|         2339|   3|
 2024-09-20|         2434|   5|
 2024-09-20|         2451|  -1|
 2024-09-20|         2552|   2|
 2024-09-20|         2600|   4|
 2024-09-20|         2643|  -1|
 2024-09-20|         2653|  -1|
 2024-09-20|         2678|  -1|
 2024-09-20|         2694|   4|
 2024-09-20|         2719|  -1|
 2024-09-20|         2794|   4|
 2024-09-20|         2798|  -1|
 2024-09-20|         2832|  -1|
 2024-09-20|         2854|  -1|
 2024-09-20|         2965|  -1|
 2024-09-20|         3084|   4|
 2024-09-20|         3166|   4|
 2024-09-20|         3595|  -1|
 2024-09-20|         3863|  -1|
 2024-09-20|         3906|  -1|
 2024-09-20|         3907|  -1|
 2024-09-20|         4116|   5|
 2024-09-20|         4139|   4|
 2024-09-20|         4190|  -1|
 2024-09-20|         4246|   2|
 2024-09-20|         4252|   4|
 2024-09-20|         4314|  -1|
 2024-09-20|         4332|   5|
 2024-09-20|         4361|   4|
 2024-09-20|         4396|   5|
 2024-09-20|         4498|   4|
 2024-09-20|         4522|  -1|
 2024-09-20|         4535|   3|
 2024-09-20|         4545|   5|
 2024-09-20|         4635|   4|
 2024-09-20|         4661|   2|
 2024-09-20|         4863|  -1|
 2024-09-20|         4919|  -1|
 2024-09-20|         5047|   4|
 2024-09-20|         5173|   5|
 2024-09-20|         5197|   4|
 2024-09-20|         5239|   4|
 2024-09-20|         5299|   2|
 2024-09-20|         5384|   4|
 2024-09-20|         5441|  -1|
 2024-09-20|         5516|  -1|
 2024-09-20|         5627|  -1|
 2024-09-20|         5754|  -1|
 2024-09-20|         5812|   3|
 2024-09-20|         5842|   4|
 2024-09-20|         5848|   4|
 2024-09-20|         5878|  -1|
 2024-09-20|         5920|   4|
 2024-09-20|         5932|  -1|
 2024-09-20|         5980|  -1|
 2024-09-20|         5989|  -1|
 2024-09-20|         6104|  -1|
 2024-09-20|         6110|  -1|
 2024-09-20|         6318|  -1|
 2024-09-20|         6382|  -1|
 2024-09-20|         6398|   3|
 2024-09-20|         6420|  -1|
 2024-09-20|         6420|  -1|
 2024-09-20|         6517|  -1|
 2024-09-20|         6649|  -1|
 2024-09-20|         6714|  -1|
 2024-09-20|         6721|   5|
 2024-09-20|         6869|  -1|
 2024-09-20|         6965|  -1|
 2024-09-20|         7099|  -1|
 2024-09-20|         7153|  -1|
 2024-09-20|         7160|   5|
 2024-09-20|         7170|  -1|
 2024-09-20|         7217|  -1|
 2024-09-20|         7254|  -1|
 2024-09-20|         7307|  -1|
 2024-09-20|         7321|   5|
 2024-09-20|         7337|  -1|
 2024-09-20|         7343|  -1|
 2024-09-20|         7369|  -1|
 2024-09-20|         7382|  -1|
 2024-09-20|         7429|  -1|
 2024-09-20|         7429|   5|
 2024-09-20|         7580|  -1|
 2024-09-20|         7692|  -1|
 2024-09-20|         7888|  -1|
 2024-09-20|         7904|   3|
 2024-09-20|         7927|   3|
 2024-09-20|         7966|   2|
 2024-09-20|         8137|   5|
 2024-09-20|         8143|   2|
 2024-09-20|         8181|  -1|
 2024-09-20|         8192|   2|
 2024-09-20|         8196|  -1|
 2024-09-20|         8225|   4|
 2024-09-20|         8382|  -1|
 2024-09-20|         8588|  -1|
 2024-09-20|         8711|   4|
 2024-09-20|         8777|   5|
 2024-09-20|         8955|   3|
 2024-09-20|         8962|  -1|
 2024-09-20|         8992|   4|
 2024-09-20|         9007|  -1|
 2024-09-20|         9028|  -1|
 2024-09-20|         9062|  -1|
 2024-09-20|         9068|   4|
 2024-09-20|         9189|   3|
 2024-09-20|         9229|  -1|
 2024-09-20|         9236|   4|
 2024-09-20|         9272|   3|
 2024-09-20|         9322|   4|
 2024-09-20|         9346|   4|
 2024-09-20|         9451|  -1|
 2024-09-20|         9472|  -1|
 2024-09-20|         9572|   4|
 2024-09-20|         9596|  -1|
 2024-09-20|         9682|   4|
 2024-09-20|         9698|   3|
 2024-09-20|         9830|   3|
 2024-09-20|         9864|  -1|
 2024-09-20|         9886|  -1|
 2024-09-20|         9909|   5|
 2024-09-20|         9915|   3|
 2024-09-20|         9934|  -1|
 2024-09-20|        10067|  -1|
 2024-09-20|        10112|  -1|
 2024-09-20|        10121|  -1|
 2024-09-20|        10228|   2|
 2024-09-20|        10278|  -1|
 2024-09-20|        10307|  -1|
 2024-09-20|        10307|   4|
 2024-09-20|        10403|  -1|
 2024-09-20|        10539|  -1|
 2024-09-20|        10611|   5|
 2024-09-20|        10638|  -1|
 2024-09-20|        10655|  -1|
 2024-09-20|        10846|   5|
 2024-09-20|        10907|  -1|
 2024-09-20|        10919|   4|
 2024-09-20|        10922|   4|
 2024-09-20|        10943|   4|
 2024-09-20|        10987|   5|
 2024-09-20|        11014|  -1|
 2024-09-20|        11052|   5|
 2024-09-20|        11289|   5|
 2024-09-20|        11361|  -1|
 2024-09-20|        11777|   3|
 2024-09-20|        11982|   5|
 2024-09-20|        12021|  -1|
 2024-09-20|        12035|  -1|
 2024-09-20|        12051|   5|
 2024-09-20|        12090|   4|
 2024-09-20|        12131|  -1|
 2024-09-20|        12351|   2|
 2024-09-20|        12376|  -1|
 2024-09-20|        12413|  -1|
 2024-09-20|        12418|  -1|
 2024-09-20|        12448|  -1|
```

### 17. Получаем количество уникальных значений lesson_date и mark
```sql
SELECT count(DISTINCT lesson_date) FROM learn_db.mart_student_lesson_idx;
SELECT count(DISTINCT mark) FROM learn_db.mart_student_lesson_idx;
```

Результат
```text
countDistinct(lesson_date)|
--------------------------+
                       366|
                       
countDistinct(mark)|
-------------------+
                  5|                       
```

### 18. Пересоздаем таблицу с первым полем в первичном индексе, в котором меньше всего уникальных значений
```sql
DROP TABLE IF EXISTS learn_db.mart_student_lesson_idx;
CREATE TABLE learn_db.mart_student_lesson_idx
(
	`student_profile_id` Int32, -- Идентификатор профиля обучающегося
	`person_id` String, -- GUID обучающегося
	`person_id_int` Int32 CODEC(Delta, ZSTD),
	`educational_organization_id` Int16, -- Идентификатор образовательной организации
	`parallel_id` Int16,
	`class_id` Int16, -- Идентификатор класса
	`lesson_date` Date32, -- Дата урока
	`lesson_month_digits` String,
	`lesson_month_text` String,
	`lesson_year` UInt16,
	`load_date` Date, -- Дата загрузки данных
	`t` Int16 CODEC(Delta, ZSTD),
	`teacher_id` Int32 CODEC(Delta, ZSTD), -- Идентификатор учителя
	`subject_id` Int16 CODEC(Delta, ZSTD), -- Идентификатор предмета
	`subject_name` String,
	`mark` Int8, -- Оценка
	PRIMARY KEY (mark, lesson_date, person_id_int)
) ENGINE = MergeTree()
AS
SELECT
	student_profile_id,
	person_id,
	person_id_int,
	educational_organization_id,
	parallel_id,
	class_id,
	lesson_date,
	lesson_month_digits,
	lesson_month_text,
	lesson_year,
	load_date,
	t,
	teacher_id,
	subject_id,
	subject_name,
	mark
FROM
	learn_db.mart_student_lesson;
```

### 19. Смотрим план выполнения запроса со статистикой по применению индекса
```sql
EXPLAIN indexes = 1
SELECT 
	avg(mark) as avg_m,
	teacher_id
FROM 
	learn_db.mart_student_lesson_idx
WHERE 
	lesson_date = subtractDays(today(), 10)
GROUP BY
	teacher_id
ORDER BY avg_m desc
LIMIT 10;
```

Результат
```text
explain                                                           |
------------------------------------------------------------------+
Expression (Project names)                                        |
  Limit (preliminary LIMIT (without OFFSET))                      |
    Sorting (Sorting for ORDER BY)                                |
      Expression ((Before ORDER BY + Projection))                 |
        Aggregating                                               |
          Expression (Before GROUP BY)                            |
            Expression                                            |
              ReadFromMergeTree (learn_db.mart_student_lesson_idx)|
              Indexes:                                            |
                PrimaryKey                                        |
                  Keys:                                           |
                    lesson_date                                   |
                  Condition: (lesson_date in [20341, 20341])      |
                  Parts: 5/5                                      |
                  Granules: 43/1223                               |
```